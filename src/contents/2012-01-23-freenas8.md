---
layout: post
status: publish
published: true
title: FreeNAS8をやってみた
author:
  display_name: yoichiro
  login: yoichiro
  email: yoichiro@eisbahn.jp
  url: ''
author_login: yoichiro
author_email: yoichiro@eisbahn.jp
wordpress_id: 1286
wordpress_url: http://www.eisbahn.jp/yoichiro/?p=1286
date: '2012-01-23 09:20:34 +0900'
date_gmt: '2012-01-23 00:20:34 +0900'
categories:
- My PC environment
---

2TBのディスクを2本持っていて、一つは昔から貯めてきた様々なファイル群とKVMで動作させている各種OSのイメージファイルを入れてアクティブに、もう一つはそれらのバックアップ先として定期rsyncかけていました。ただ、最近ではFreeNASという無償のファイルサーバ用OSがあるらしいじゃないですか。YAuthも通ったので、サーバを一つ作って、それに2TBのHDDを突っ込んで冗長構成を組み立ててみようかなと思い、チャレンジしました。

買ったのは以下の部品。

* ケース： 型番とかわからないけど400Wな電源付きのHDDが8台くらい乗せられるもの

* MB: GA-880GM-USB3L

* CPU: Athlon II X2 Dual-Core 240e

* MEM: 2GB x 2

* HDD: 2TB x 4

使ったOSは、FreeNAS 8.0.3。安定稼働までにはまった点を残しておく。

* USB3をサポートするUSBメモリを購入するも、FreeNASのインストール時にターゲットにできなかった。USB2のスロットに差すことで問題なくインストールできた。

* その前に、MBのCPUファンへの電源供給がわからず、最初途方に暮れる。MBのコネクタは2x2なのに対して、ケースにはそんな端子はなく3x2もしくは4x2しかない。いろいろ試したが、3x2を強引に(?)2x2に差すことで無事電源供給された。ぐぐると、これでどうも正解らしい。

* SATAのケーブルを差し替えたり、後でHDDを追加しても、BIOSレベルで認識せずに途方に暮れる。一か八かのCMOSリセットで無事認識した。こういうもの？

* 最初2TB3本でraid-z1にしてウッヒャーだったが、同僚に「は？raid-z1なんて信用してんの？」と助言をいただき、速やかにraid-z2に移行。z1の時には3.6TBがフリーエリアとして使えていて、2TBをもう一本足すことで容量増えるぜウヒヒっと勘違いしていたが、z2になることで3本から4本になってもフリーエリアは変化せず。その分強固になってるからいいんだけど。

* ファイルコピー時に最初だいたい8MB/s出ていて満足してたんだけど、どうやらそれで満足してはいけなかった模様。Hubがそもそもルータのを使っていたせいで、100Mb/sになってた。昨日1G対応Hubを購入することで、NICも1000で認識し、30MB/sを超えるスピードになった。速い。

* ただし、3つあるサーバのうち、LANケーブルが「カテゴリ6e x 1、カテゴリ5 x 2」という状態で、カテゴリ５の一本は奇跡的に1000でいけてるものの、もう一本は1000は無理だった。ケーブルを買い直すことを検討中。

* Virtual PC on FreeNASが実現可能、という話を見つけていたので期待してFreeNASをインストールしたが、それはFreeNAS7の頃の話っぽい。まだFreeNAS8での実績は見つけられていなくて、しかもFreeNAS8ではiTunesサーバの機能は未搭載。でもTime machineは完璧に動作しているので、よしとする。

何はともあれ、データのロストがこれでなくなればいいなー。
