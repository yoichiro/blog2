---
layout: post
status: publish
published: true
title: DNSに挑戦！
author:
  display_name: yoichiro
  login: yoichiro
  email: yoichiro@eisbahn.jp
  url: ''
author_login: yoichiro
author_email: yoichiro@eisbahn.jp
wordpress_id: 82
wordpress_url: http://www.eisbahn.jp/yoichiro/?p=82
date: '2005-06-26 19:46:10 +0900'
date_gmt: '2005-06-26 10:46:10 +0900'
categories:
- My PC environment
---

ある日，So-netから「
[固定IPサービス](http://www.so-net.ne.jp/staticip/)」開始のメールが僕のところに届いた。グローバルIPアドレスの取得は，以前は金額的にも何か手が届かないなぁと思っていたが，最近では極々普通のサービスになったようだ。

「何か楽しそうなことないかなぁ」と思っていたので，早速固定IPアドレスをGet!した。これにより，PPPoE認証後に必ず同じIPアドレスが割り当てられるようになった。これで前からやってみたかったことが実現できる。それは「自ドメインの取得と運用」だ。

ネットでの調査と，いろんな人に聞きまくった結果，以下のようなことが必要だとわかった。

* 自ドメインの取得は，JPNIC直ではなく，そこから認可されたレジストラ(?)に依頼する。

* DNSの運用は，セカンダリを用意しないといけない。しかも，自分のネット環境で2台用意するのではなく，全く別の場所に用意しないといけない。

* セカンダリを無料で引き受けてくれるサービスが，この世に存在する。

* 最近のBINDは，LAN側の設定とWAN側の設定を，分けて(?)記述できる。

自分の知識なんて，こんなものです，はぃ。

さて，早速自ドメインの取得をどこにしようか検索。信頼できる(?)ところということで，
[NTT Communicationsのドメイン登録サービス](http://www.nttdomain.com/)に決定。運よく希望のドメインは誰も使っていないようなので，第1候補をすんなりと取得できた。自分の情報と料金の払い方，あとWhois情報も登録。Whois情報は普通に一般に公開されてしまう情報だけど，住所とか電話番号はさすがに伏せておきたい。でも，03-0000-0000とか入力しても，エラーになってしまった。うーん，個人情報おもいっきり公開されちゃってる状況ってどうなんだろ・・・。

そしていよいよ，BINDのインストール＆設定を開始。「
[外部／内部向けDNSサーバー構築(BIND)](http://fedorasrv.com/bind-wan.shtml)」という，ほぼ答えのサイトを発見。基本的には書いてある通りに設定をした。ちゃんとマシン名とかを管理したかったので，「* IN A ･･･」のような記述は使わずに，「hoge IN A ・・・」とアレンジした。

一通り設定ファイルを作って，いざBIND実行。ルータの設定で53番を穴あけし，クライアントのPCのDNSを，BINDをインストールしたマシンに変更。おぉ！ちゃんとDNS引けてるじゃん！BINDを止めればIPアドレスを引けなくなったので，BINDはうまく動き出したようだ。LAN内のマシンの特定もばっちりだし，外部のドメイン名の解決はちゃんとプロバイダのDNSにフォワードされているみたい。やったぁ！

しかし，致命的なミスを犯したことに気がついた。プライマリネームサーバのIPアドレスを間違って登録してしまったのだ。あとでWhoisを見ても，しっかりと間違ったIPアドレスのままでルートDNSに登録されてしまい，外部から引けない状態に。どうやら
[NTT Communicationsのドメイン登録サービス](http://www.nttdomain.com/)のマシンのアドレスが，僕のDNSサーバのアドレスになってしまった模様。一応すぐに管理ツールで変更はしたものの，その反映は何時間もあと。残念でたまらない。

あとできることといえば，セカンダリDNSだ。セカンダリDNSは，
[FREEのセカンダリDNSを使う](http://cmf.ohtanz.com/secdns.html)で紹介されていた「
[Xname](http://www.xname.org/index.php)」を利用することにした。手順も同サイトに書かれている通りに行い，自分のDNSにもXname用の設定を記述，BINDを再起動した。しばらくすると，Xnameからメールが届き，XnameのDNSに僕のDNSのゾーンが記述されていることを確認。

セカンダリDNSも準備OKなので，
[NTT Communicationsのドメイン登録サービス](http://www.nttdomain.com/)にセカンダリDNSの登録も行った。これで，あとはルートDNSの設定が正しい情報に更新されれば，自ドメインの設置完了だ。

BINDはすぐに設定の効果がLAN内では把握できるため，なかなか面白い。ホントは外から自ドメインでアクセスできるのを確認できると嬉しいんだけど，完全に自業自得なので，しばらく我慢。参考にできるサイトがあったため，作業自体はさほど難しくなかったが，情報量が少ないと，相当苦戦しただろうな。

ホントは自ドメインを公開したいところだが，設定に失敗してしまったのと，設定の内容に自信がないため，ドメイン名の公開はまだ控えることにする。早く更新されないかなぁ。。。
